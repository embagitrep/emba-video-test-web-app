$(document).ready(function () {
    $(".file-repeater, .contact-repeater, .repeater-default").repeater({
        show: function () {
            $(this).slideDown()
        }, hide: function (e) {
            confirm("Are you sure you want to delete this element?") && $(this).slideUp(e)
        }
    })
});

$('.guarantee-repeater').repeater({
    initEmpty: false,
    defaultValues: {
        'name': '',
        'email': '',
    },
    show: function () {
        // let count = updateRowCount()

        // if (count > 2) {
        //     $(this).remove();
        // } else {
        //     $(this).slideDown();
        //     updateRowCount();
        // }
        $('.js--phone').inputmask("(999) 999-99-99");
        $(this).find(':input:disabled').prop('disabled', false);
        $(this).find('.js--verifyGuarantor').remove();
        $(this).find('button').removeAttr('data-url')
        $(this).slideDown()
    }, hide: function (e) {
        let url = $(this).find('button').data('url')

        let confirmed = confirm("Are you sure you want to delete this element?");

        if (confirmed){
            if (url !== undefined)
                removeGuarantor(url,$(this), e)
            else
                $(this).slideUp(e);
        }

        // updateRowCount()
    },
    ready: function (setIndexes) {
        setIndexes()
    }
})

$('.guarantee-repeater-corp').repeater({
    initEmpty: false,
    show: function () {

        $(this).find(':input:disabled').prop('disabled', false);
        $(this).find(':input').removeClass('hidden');
        $(this).find('.js--viewBtn').remove();
        $(this).find('button').removeAttr('data-url')
        $(this).slideDown()
    }, hide: function (e) {
        let url = $(this).find('button').data('url')

        let confirmed = confirm("Are you sure you want to delete this element?");

        if (confirmed){
            if (url !== undefined)
                removeGuarantor(url,$(this), e)
            else
                $(this).slideUp(e);
        }

    },
    ready: function (setIndexes) {
        setIndexes()
    }
})

function updateRowCount() {
    const rowCount = $('[data-repeater-item]').length;

    if (rowCount > 2) {
        $('.js--addGuaranteeBtn').prop('disabled', true);
    } else {
        $('.js--addGuaranteeBtn').prop('disabled', false);
    }
    return  rowCount;

}

// updateRowCount();

function removeGuarantor(url, elem, event) {
    $.ajax({
        url,
        success: function (data){
            if (data.success) elem.slideUp(event);
        }
    })
}